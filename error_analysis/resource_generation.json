{
	"non_functional_requirement": "memory",
	"commit": "https:\/\/github.com\/erikusaj\/fdroidTvClient\/commit\/f7bbf0e282f10f649cb087be85269b5f7acce6ea",
	"commit_message": "'\\\\\"Use `getApplicationContext()` instead of `getContext()` to prevent memory leaks.\\\\n\\\\nUsing whatever `Activity` as the `Context` used to construct the first content\\\\nprovider means that it will be help onto in memory until the application is GC\\'ed.\\\\n\\\\\"'",
	"source_code": "package org.fdroid.fdroid.data;\n\nimport android.annotation.TargetApi;\nimport android.content.ContentProvider;\nimport android.content.ContentProviderOperation;\nimport android.content.ContentProviderResult;\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.content.OperationApplicationException;\nimport android.content.UriMatcher;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.net.Uri;\nimport android.os.Build;\nimport android.support.annotation.NonNull;\n\nimport org.fdroid.fdroid.Utils;\n\nimport java.util.ArrayList;\nimport java.util.HashSet;\nimport java.util.Map;\nimport java.util.Set;\n\npublic abstract class FDroidProvider extends ContentProvider {\n\n    private static final String TAG = \"FDroidProvider\";\n\n    public static final String AUTHORITY = \"org.fdroid.fdroid.data\";\n\n    protected static final int CODE_LIST   = 1;\n    protected static final int CODE_SINGLE = 2;\n\n    private static DBHelper dbHelper;\n\n    private boolean isApplyingBatch;\n\n    protected abstract String getTableName();\n\n    protected abstract String getProviderName();\n\n    \/**\n     * Should always be the same as the provider:name in the AndroidManifest\n     *\/\n    public final String getName() {\n        return AUTHORITY + \".\" + getProviderName();\n    }\n\n    \/**\n     * Tells us if we are in the middle of a batch of operations. Allows us to\n     * decide not to notify the content resolver of changes,\n     * every single time we do something during many operations.\n     * Based on http:\/\/stackoverflow.com\/a\/15886915.\n     *\/\n    protected final boolean isApplyingBatch() {\n        return this.isApplyingBatch;\n    }\n\n    @NonNull\n    @Override\n    public ContentProviderResult[] applyBatch(@NonNull ArrayList<ContentProviderOperation> operations)\n        throws OperationApplicationException {\n        ContentProviderResult[] result = null;\n        isApplyingBatch = true;\n        final SQLiteDatabase db = db();\n        db.beginTransaction();\n        try {\n            result = super.applyBatch(operations);\n            db.setTransactionSuccessful();\n        } finally {\n            db.endTransaction();\n            isApplyingBatch = false;\n        }\n        return result;\n    }\n\n    private static synchronized DBHelper getOrCreateDb(Context context) {\n        if (dbHelper == null) {\n            Utils.debugLog(TAG, \"First time accessing database, creating new helper\");\n            dbHelper = new DBHelper(context);\n        }\n        return dbHelper;\n    }\n\n    @Override\n    public boolean onCreate() {\n        return true;\n    }\n\n    protected final synchronized SQLiteDatabase db() {\n        return getOrCreateDb(getContext()).getWritableDatabase();\n    }\n\n    @Override\n    public String getType(@NonNull Uri uri) {\n        String type;\n        switch (getMatcher().match(uri)) {\n            case CODE_LIST:\n                type = \"dir\";\n                break;\n            case CODE_SINGLE:\n            default:\n                type = \"item\";\n                break;\n        }\n        return \"vnd.android.cursor.\" + type + \"\/vnd.\" + AUTHORITY + \".\" + getProviderName();\n    }\n\n    protected abstract UriMatcher getMatcher();\n\n    protected static String generateQuestionMarksForInClause(int num) {\n        StringBuilder sb = new StringBuilder(num * 2);\n        for (int i = 0; i < num; i++) {\n            if (i != 0) {\n                sb.append(',');\n            }\n            sb.append('?');\n        }\n        return sb.toString();\n    }\n\n    @TargetApi(11)\n    protected Set<String> getKeySet(ContentValues values) {\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {\n            return values.keySet();\n        }\n\n        Set<String> keySet = new HashSet<>();\n        for (Map.Entry<String, Object> item : values.valueSet()) {\n            String key = item.getKey();\n            keySet.add(key);\n        }\n        return keySet;\n\n    }\n\n    protected void validateFields(String[] validFields, ContentValues values)\n        throws IllegalArgumentException {\n        for (final String key : getKeySet(values)) {\n            boolean isValid = false;\n            for (final String validKey : validFields) {\n                if (validKey.equals(key)) {\n                    isValid = true;\n                    break;\n                }\n            }\n\n            if (!isValid) {\n                throw new IllegalArgumentException(\n                    \"Cannot save field '\" + key + \"' to provider \" + getProviderName());\n            }\n        }\n    }\n}\n",
	"target_code": "package org.fdroid.fdroid.data;\n\nimport android.annotation.TargetApi;\nimport android.content.ContentProvider;\nimport android.content.ContentProviderOperation;\nimport android.content.ContentProviderResult;\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.content.OperationApplicationException;\nimport android.content.UriMatcher;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.net.Uri;\nimport android.os.Build;\nimport android.support.annotation.NonNull;\n\nimport org.fdroid.fdroid.Utils;\n\nimport java.util.ArrayList;\nimport java.util.HashSet;\nimport java.util.Map;\nimport java.util.Set;\n\npublic abstract class FDroidProvider extends ContentProvider {\n\n    private static final String TAG = \"FDroidProvider\";\n\n    public static final String AUTHORITY = \"org.fdroid.fdroid.data\";\n\n    protected static final int CODE_LIST   = 1;\n    protected static final int CODE_SINGLE = 2;\n\n    private static DBHelper dbHelper;\n\n    private boolean isApplyingBatch;\n\n    protected abstract String getTableName();\n\n    protected abstract String getProviderName();\n\n    \/**\n     * Should always be the same as the provider:name in the AndroidManifest\n     *\/\n    public final String getName() {\n        return AUTHORITY + \".\" + getProviderName();\n    }\n\n    \/**\n     * Tells us if we are in the middle of a batch of operations. Allows us to\n     * decide not to notify the content resolver of changes,\n     * every single time we do something during many operations.\n     * Based on http:\/\/stackoverflow.com\/a\/15886915.\n     *\/\n    protected final boolean isApplyingBatch() {\n        return this.isApplyingBatch;\n    }\n\n    @NonNull\n    @Override\n    public ContentProviderResult[] applyBatch(@NonNull ArrayList<ContentProviderOperation> operations)\n        throws OperationApplicationException {\n        ContentProviderResult[] result = null;\n        isApplyingBatch = true;\n        final SQLiteDatabase db = db();\n        db.beginTransaction();\n        try {\n            result = super.applyBatch(operations);\n            db.setTransactionSuccessful();\n        } finally {\n            db.endTransaction();\n            isApplyingBatch = false;\n        }\n        return result;\n    }\n\n    private static synchronized DBHelper getOrCreateDb(Context context) {\n        if (dbHelper == null) {\n            Utils.debugLog(TAG, \"First time accessing database, creating new helper\");\n            dbHelper = new DBHelper(context);\n        }\n        return dbHelper;\n    }\n\n    @Override\n    public boolean onCreate() {\n        return true;\n    }\n\n    protected final synchronized SQLiteDatabase db() {\n        return getOrCreateDb(getContext().getApplicationContext()).getWritableDatabase();\n    }\n\n    @Override\n    public String getType(@NonNull Uri uri) {\n        String type;\n        switch (getMatcher().match(uri)) {\n            case CODE_LIST:\n                type = \"dir\";\n                break;\n            case CODE_SINGLE:\n            default:\n                type = \"item\";\n                break;\n        }\n        return \"vnd.android.cursor.\" + type + \"\/vnd.\" + AUTHORITY + \".\" + getProviderName();\n    }\n\n    protected abstract UriMatcher getMatcher();\n\n    protected static String generateQuestionMarksForInClause(int num) {\n        StringBuilder sb = new StringBuilder(num * 2);\n        for (int i = 0; i < num; i++) {\n            if (i != 0) {\n                sb.append(',');\n            }\n            sb.append('?');\n        }\n        return sb.toString();\n    }\n\n    @TargetApi(11)\n    protected Set<String> getKeySet(ContentValues values) {\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {\n            return values.keySet();\n        }\n\n        Set<String> keySet = new HashSet<>();\n        for (Map.Entry<String, Object> item : values.valueSet()) {\n            String key = item.getKey();\n            keySet.add(key);\n        }\n        return keySet;\n\n    }\n\n    protected void validateFields(String[] validFields, ContentValues values)\n        throws IllegalArgumentException {\n        for (final String key : getKeySet(values)) {\n            boolean isValid = false;\n            for (final String validKey : validFields) {\n                if (validKey.equals(key)) {\n                    isValid = true;\n                    break;\n                }\n            }\n\n            if (!isValid) {\n                throw new IllegalArgumentException(\n                    \"Cannot save field '\" + key + \"' to provider \" + getProviderName());\n            }\n        }\n    }\n}\n",
	"pl": "Java",
	"classification_left_prompt": "Below is an instruction that describes a task. Write a response that appropriately completes the request.\n### Instruction:\n\nOnly one of the two code snippets has a lower memory usage.\n\nCode-A:\n\/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http:\/\/mozilla.org\/MPL\/2.0\/. *\/\n\npackage org.mozilla.focus.web;\n\nimport android.annotation.SuppressLint;\nimport android.content.Context;\nimport android.graphics.Bitmap;\nimport android.util.AttributeSet;\nimport android.view.View;\nimport android.webkit.CookieManager;\nimport android.webkit.WebChromeClient;\nimport android.webkit.WebSettings;\nimport android.webkit.WebStorage;\nimport android.webkit.WebView;\nimport android.webkit.WebViewDatabase;\n\nimport org.mozilla.focus.webkit.NestedWebView;\nimport org.mozilla.focus.webkit.TrackingProtectionWebViewClient;\n\n\/**\n * WebViewProvider for creating a WebKit based IWebVIew implementation.\n *\/\npublic class WebViewProvider {\n    \/**\n     * Preload webview data. This allows the webview implementation to load resources and other data\n     * it might need, in advance of intialising the view (at which time we are probably wanting to\n     * show a website immediately).\n     *\/\n    public static void preload(final Context context) {\n        TrackingProtectionWebViewClient.triggerPreload(context);\n    }\n\n    public static View create(Context context, AttributeSet attrs) {\n        final WebkitView webkitView = new WebkitView(context, attrs);\n\n        setupView(webkitView);\n        configureSettings(webkitView.getSettings());\n\n        return webkitView;\n    }\n\n    private static void setupView(WebView webView) {\n        webView.setVerticalScrollBarEnabled(true);\n        webView.setHorizontalScrollBarEnabled(true);\n    }\n\n    @SuppressLint(\"SetJavaScriptEnabled\") \/\/ We explicitly want to enable JavaScript\n    private static void configureSettings(WebSettings settings) {\n        settings.setJavaScriptEnabled(true);\n\n        \/\/ Enabling built in zooming shows the controls by default\n        settings.setBuiltInZoomControls(true);\n\n        \/\/ So we hide the controls after enabling zooming\n        settings.setDisplayZoomControls(false);\n    }\n\n    private static class WebkitView extends NestedWebView implements IWebView {\n        private Callback callback;\n        private TrackingProtectionWebViewClient client;\n\n        public WebkitView(Context context, AttributeSet attrs) {\n            super(context, attrs);\n\n            client = createWebViewClient();\n\n            setWebViewClient(client);\n            setWebChromeClient(createWebChromeClient());\n        }\n\n        @Override\n        public void setCallback(Callback callback) {\n            this.callback = callback;\n        }\n\n        public void loadUrl(String url) {\n            super.loadUrl(url);\n\n            client.notifyCurrentURL(url);\n        }\n\n        @Override\n        public void cleanup() {\n            clearFormData();\n            clearHistory();\n            clearMatches();\n            clearSslPreferences();\n            clearCache(true);\n\n            \/\/ We don't care about the callback - we just want to make sure cookies are gone\n            CookieManager.getInstance().removeAllCookies(null);\n\n            WebStorage.getInstance().deleteAllData();\n\n            final WebViewDatabase webViewDatabase = WebViewDatabase.getInstance(getContext());\n            \/\/ It isn't entirely clear how this differs from WebView.clearFormData()\n            webViewDatabase.clearFormData();\n            webViewDatabase.clearHttpAuthUsernamePassword();\n        }\n\n        private TrackingProtectionWebViewClient createWebViewClient() {\n            return new TrackingProtectionWebViewClient(getContext().getApplicationContext()) {\n                @Override\n                public void onPageStarted(WebView view, String url, Bitmap favicon) {\n                    if (callback != null) {\n                        callback.onPageStarted(url);\n                    }\n                    super.onPageStarted(view, url, favicon);\n                }\n\n                @Override\n                public void onPageFinished(WebView view, String url) {\n                    if (callback != null) {\n                        callback.onPageFinished(view.getCertificate() != null);\n                    }\n                    super.onPageFinished(view, url);\n                }\n            };\n        }\n\n        private WebChromeClient createWebChromeClient() {\n            return new WebChromeClient() {\n                @Override\n                public void onProgressChanged(WebView view, int newProgress) {\n                    if (callback != null) {\n                        callback.onProgress(newProgress);\n                    }\n                }\n            };\n        }\n    }\n}\n\n\nCode-B:\n\/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http:\/\/mozilla.org\/MPL\/2.0\/. *\/\n\npackage org.mozilla.focus.web;\n\nimport android.annotation.SuppressLint;\nimport android.content.Context;\nimport android.graphics.Bitmap;\nimport android.util.AttributeSet;\nimport android.view.View;\nimport android.webkit.WebChromeClient;\nimport android.webkit.WebSettings;\nimport android.webkit.WebView;\n\nimport org.mozilla.focus.webkit.NestedWebView;\nimport org.mozilla.focus.webkit.TrackingProtectionWebViewClient;\n\n\/**\n * WebViewProvider for creating a WebKit based IWebVIew implementation.\n *\/\npublic class WebViewProvider {\n    \/**\n     * Preload webview data. This allows the webview implementation to load resources and other data\n     * it might need, in advance of intialising the view (at which time we are probably wanting to\n     * show a website immediately).\n     *\/\n    public static void preload(final Context context) {\n        TrackingProtectionWebViewClient.triggerPreload(context);\n    }\n\n    public static View create(Context context, AttributeSet attrs) {\n        final WebkitView webkitView = new WebkitView(context, attrs);\n\n        setupView(webkitView);\n        configureSettings(webkitView.getSettings());\n\n        return webkitView;\n    }\n\n    private static void setupView(WebView webView) {\n        webView.setVerticalScrollBarEnabled(true);\n        webView.setHorizontalScrollBarEnabled(true);\n    }\n\n    @SuppressLint(\"SetJavaScriptEnabled\") \/\/ We explicitly want to enable JavaScript\n    private static void configureSettings(WebSettings settings) {\n        settings.setJavaScriptEnabled(true);\n\n        \/\/ Enabling built in zooming shows the controls by default\n        settings.setBuiltInZoomControls(true);\n\n        \/\/ So we hide the controls after enabling zooming\n        settings.setDisplayZoomControls(false);\n    }\n\n    private static class WebkitView extends NestedWebView implements IWebView {\n        private Callback callback;\n        private TrackingProtectionWebViewClient client;\n\n        public WebkitView(Context context, AttributeSet attrs) {\n            super(context, attrs);\n\n            client = createWebViewClient();\n\n            setWebViewClient(client);\n            setWebChromeClient(createWebChromeClient());\n        }\n\n        @Override\n        public void setCallback(Callback callback) {\n            this.callback = callback;\n        }\n\n        public void loadUrl(String url) {\n            super.loadUrl(url);\n\n            client.notifyCurrentURL(url);\n        }\n\n        @Override\n        public void cleanup() {\n            clearFormData();\n            clearHistory();\n            clearMatches();\n            clearSslPreferences();\n            clearCache(true);\n        }\n\n        private TrackingProtectionWebViewClient createWebViewClient() {\n            return new TrackingProtectionWebViewClient(getContext().getApplicationContext()) {\n                @Override\n                public void onPageStarted(WebView view, String url, Bitmap favicon) {\n                    if (callback != null) {\n                        callback.onPageStarted(url);\n                    }\n                    super.onPageStarted(view, url, favicon);\n                }\n\n                @Override\n                public void onPageFinished(WebView view, String url) {\n                    if (callback != null) {\n                        callback.onPageFinished(view.getCertificate() != null);\n                    }\n                    super.onPageFinished(view, url);\n                }\n            };\n        }\n\n        private WebChromeClient createWebChromeClient() {\n            return new WebChromeClient() {\n                @Override\n                public void onProgressChanged(WebView view, int newProgress) {\n                    if (callback != null) {\n                        callback.onProgress(newProgress);\n                    }\n                }\n            };\n        }\n    }\n}\n\n\nPlease select the code snippet from Code-A or Code-B with a lower memory usage utilization.\n\n### Response: Code-",
	"classification_left_label": "A",
	"classification_right_prompt": "Below is an instruction that describes a task. Write a response that appropriately completes the request.\n### Instruction:\n\nOnly one of the two code snippets has a lower memory usage.\n\nCode-A:\n\/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http:\/\/mozilla.org\/MPL\/2.0\/. *\/\n\npackage org.mozilla.focus.web;\n\nimport android.annotation.SuppressLint;\nimport android.content.Context;\nimport android.graphics.Bitmap;\nimport android.util.AttributeSet;\nimport android.view.View;\nimport android.webkit.WebChromeClient;\nimport android.webkit.WebSettings;\nimport android.webkit.WebView;\n\nimport org.mozilla.focus.webkit.NestedWebView;\nimport org.mozilla.focus.webkit.TrackingProtectionWebViewClient;\n\n\/**\n * WebViewProvider for creating a WebKit based IWebVIew implementation.\n *\/\npublic class WebViewProvider {\n    \/**\n     * Preload webview data. This allows the webview implementation to load resources and other data\n     * it might need, in advance of intialising the view (at which time we are probably wanting to\n     * show a website immediately).\n     *\/\n    public static void preload(final Context context) {\n        TrackingProtectionWebViewClient.triggerPreload(context);\n    }\n\n    public static View create(Context context, AttributeSet attrs) {\n        final WebkitView webkitView = new WebkitView(context, attrs);\n\n        setupView(webkitView);\n        configureSettings(webkitView.getSettings());\n\n        return webkitView;\n    }\n\n    private static void setupView(WebView webView) {\n        webView.setVerticalScrollBarEnabled(true);\n        webView.setHorizontalScrollBarEnabled(true);\n    }\n\n    @SuppressLint(\"SetJavaScriptEnabled\") \/\/ We explicitly want to enable JavaScript\n    private static void configureSettings(WebSettings settings) {\n        settings.setJavaScriptEnabled(true);\n\n        \/\/ Enabling built in zooming shows the controls by default\n        settings.setBuiltInZoomControls(true);\n\n        \/\/ So we hide the controls after enabling zooming\n        settings.setDisplayZoomControls(false);\n    }\n\n    private static class WebkitView extends NestedWebView implements IWebView {\n        private Callback callback;\n        private TrackingProtectionWebViewClient client;\n\n        public WebkitView(Context context, AttributeSet attrs) {\n            super(context, attrs);\n\n            client = createWebViewClient();\n\n            setWebViewClient(client);\n            setWebChromeClient(createWebChromeClient());\n        }\n\n        @Override\n        public void setCallback(Callback callback) {\n            this.callback = callback;\n        }\n\n        public void loadUrl(String url) {\n            super.loadUrl(url);\n\n            client.notifyCurrentURL(url);\n        }\n\n        @Override\n        public void cleanup() {\n            clearFormData();\n            clearHistory();\n            clearMatches();\n            clearSslPreferences();\n            clearCache(true);\n        }\n\n        private TrackingProtectionWebViewClient createWebViewClient() {\n            return new TrackingProtectionWebViewClient(getContext().getApplicationContext()) {\n                @Override\n                public void onPageStarted(WebView view, String url, Bitmap favicon) {\n                    if (callback != null) {\n                        callback.onPageStarted(url);\n                    }\n                    super.onPageStarted(view, url, favicon);\n                }\n\n                @Override\n                public void onPageFinished(WebView view, String url) {\n                    if (callback != null) {\n                        callback.onPageFinished(view.getCertificate() != null);\n                    }\n                    super.onPageFinished(view, url);\n                }\n            };\n        }\n\n        private WebChromeClient createWebChromeClient() {\n            return new WebChromeClient() {\n                @Override\n                public void onProgressChanged(WebView view, int newProgress) {\n                    if (callback != null) {\n                        callback.onProgress(newProgress);\n                    }\n                }\n            };\n        }\n    }\n}\n\n\nCode-B:\n\/* -*- Mode: Java; c-basic-offset: 4; tab-width: 20; indent-tabs-mode: nil; -*-\n * This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http:\/\/mozilla.org\/MPL\/2.0\/. *\/\n\npackage org.mozilla.focus.web;\n\nimport android.annotation.SuppressLint;\nimport android.content.Context;\nimport android.graphics.Bitmap;\nimport android.util.AttributeSet;\nimport android.view.View;\nimport android.webkit.CookieManager;\nimport android.webkit.WebChromeClient;\nimport android.webkit.WebSettings;\nimport android.webkit.WebStorage;\nimport android.webkit.WebView;\nimport android.webkit.WebViewDatabase;\n\nimport org.mozilla.focus.webkit.NestedWebView;\nimport org.mozilla.focus.webkit.TrackingProtectionWebViewClient;\n\n\/**\n * WebViewProvider for creating a WebKit based IWebVIew implementation.\n *\/\npublic class WebViewProvider {\n    \/**\n     * Preload webview data. This allows the webview implementation to load resources and other data\n     * it might need, in advance of intialising the view (at which time we are probably wanting to\n     * show a website immediately).\n     *\/\n    public static void preload(final Context context) {\n        TrackingProtectionWebViewClient.triggerPreload(context);\n    }\n\n    public static View create(Context context, AttributeSet attrs) {\n        final WebkitView webkitView = new WebkitView(context, attrs);\n\n        setupView(webkitView);\n        configureSettings(webkitView.getSettings());\n\n        return webkitView;\n    }\n\n    private static void setupView(WebView webView) {\n        webView.setVerticalScrollBarEnabled(true);\n        webView.setHorizontalScrollBarEnabled(true);\n    }\n\n    @SuppressLint(\"SetJavaScriptEnabled\") \/\/ We explicitly want to enable JavaScript\n    private static void configureSettings(WebSettings settings) {\n        settings.setJavaScriptEnabled(true);\n\n        \/\/ Enabling built in zooming shows the controls by default\n        settings.setBuiltInZoomControls(true);\n\n        \/\/ So we hide the controls after enabling zooming\n        settings.setDisplayZoomControls(false);\n    }\n\n    private static class WebkitView extends NestedWebView implements IWebView {\n        private Callback callback;\n        private TrackingProtectionWebViewClient client;\n\n        public WebkitView(Context context, AttributeSet attrs) {\n            super(context, attrs);\n\n            client = createWebViewClient();\n\n            setWebViewClient(client);\n            setWebChromeClient(createWebChromeClient());\n        }\n\n        @Override\n        public void setCallback(Callback callback) {\n            this.callback = callback;\n        }\n\n        public void loadUrl(String url) {\n            super.loadUrl(url);\n\n            client.notifyCurrentURL(url);\n        }\n\n        @Override\n        public void cleanup() {\n            clearFormData();\n            clearHistory();\n            clearMatches();\n            clearSslPreferences();\n            clearCache(true);\n\n            \/\/ We don't care about the callback - we just want to make sure cookies are gone\n            CookieManager.getInstance().removeAllCookies(null);\n\n            WebStorage.getInstance().deleteAllData();\n\n            final WebViewDatabase webViewDatabase = WebViewDatabase.getInstance(getContext());\n            \/\/ It isn't entirely clear how this differs from WebView.clearFormData()\n            webViewDatabase.clearFormData();\n            webViewDatabase.clearHttpAuthUsernamePassword();\n        }\n\n        private TrackingProtectionWebViewClient createWebViewClient() {\n            return new TrackingProtectionWebViewClient(getContext().getApplicationContext()) {\n                @Override\n                public void onPageStarted(WebView view, String url, Bitmap favicon) {\n                    if (callback != null) {\n                        callback.onPageStarted(url);\n                    }\n                    super.onPageStarted(view, url, favicon);\n                }\n\n                @Override\n                public void onPageFinished(WebView view, String url) {\n                    if (callback != null) {\n                        callback.onPageFinished(view.getCertificate() != null);\n                    }\n                    super.onPageFinished(view, url);\n                }\n            };\n        }\n\n        private WebChromeClient createWebChromeClient() {\n            return new WebChromeClient() {\n                @Override\n                public void onProgressChanged(WebView view, int newProgress) {\n                    if (callback != null) {\n                        callback.onProgress(newProgress);\n                    }\n                }\n            };\n        }\n    }\n}\n\n\nPlease select the code snippet from Code-A or Code-B with a lower memory usage utilization.\n\n### Response: Code-",
	"classification_right_label": "B",
	"inference_time": 6.5761181607,
	"generated_answers": [
		"Below is an instruction that describes a task. Write a response that appropriately completes the request.\n\n### Instruction:\nRewrite the given java program to optimize and improve the memory usage. Write the entire code and no other text in the response.\n```java\npackage org.fdroid.fdroid.data;\n\nimport android.annotation.TargetApi;\nimport android.content.ContentProvider;\nimport android.content.ContentProviderOperation;\nimport android.content.ContentProviderResult;\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.content.OperationApplicationException;\nimport android.content.UriMatcher;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.net.Uri;\nimport android.os.Build;\nimport android.support.annotation.NonNull;\n\nimport org.fdroid.fdroid.Utils;\n\nimport java.util.ArrayList;\nimport java.util.HashSet;\nimport java.util.Map;\nimport java.util.Set;\n\npublic abstract class FDroidProvider extends ContentProvider {\n\n    private static final String TAG = \"FDroidProvider\";\n\n    public static final String AUTHORITY = \"org.fdroid.fdroid.data\";\n\n    protected static final int CODE_LIST   = 1;\n    protected static final int CODE_SINGLE = 2;\n\n    private static DBHelper dbHelper;\n\n    private boolean isApplyingBatch;\n\n    protected abstract String getTableName();\n\n    protected abstract String getProviderName();\n\n    \/**\n     * Should always be the same as the provider:name in the AndroidManifest\n     *\/\n    public final String getName() {\n        return AUTHORITY + \".\" + getProviderName();\n    }\n\n    \/**\n     * Tells us if we are in the middle of a batch of operations. Allows us to\n     * decide not to notify the content resolver of changes,\n     * every single time we do something during many operations.\n     * Based on http:\/\/stackoverflow.com\/a\/15886915.\n     *\/\n    protected final boolean isApplyingBatch() {\n        return this.isApplyingBatch;\n    }\n\n    @NonNull\n    @Override\n    public ContentProviderResult[] applyBatch(@NonNull ArrayList<ContentProviderOperation> operations)\n        throws OperationApplicationException {\n        ContentProviderResult[] result = null;\n        isApplyingBatch = true;\n        final SQLiteDatabase db = db();\n        db.beginTransaction();\n        try {\n            result = super.applyBatch(operations);\n            db.setTransactionSuccessful();\n        } finally {\n            db.endTransaction();\n            isApplyingBatch = false;\n        }\n        return result;\n    }\n\n    private static synchronized DBHelper getOrCreateDb(Context context) {\n        if (dbHelper == null) {\n            Utils.debugLog(TAG, \"First time accessing database, creating new helper\");\n            dbHelper = new DBHelper(context);\n        }\n        return dbHelper;\n    }\n\n    @Override\n    public boolean onCreate() {\n        return true;\n    }\n\n    protected final synchronized SQLiteDatabase db() {\n        return getOrCreateDb(getContext()).getWritableDatabase();\n    }\n\n    @Override\n    public String getType(@NonNull Uri uri) {\n        String type;\n        switch (getMatcher().match(uri)) {\n            case CODE_LIST:\n                type = \"dir\";\n                break;\n            case CODE_SINGLE:\n            default:\n                type = \"item\";\n                break;\n        }\n        return \"vnd.android.cursor.\" + type + \"\/vnd.\" + AUTHORITY + \".\" + getProviderName();\n    }\n\n    protected abstract UriMatcher getMatcher();\n\n    protected static String generateQuestionMarksForInClause(int num) {\n        StringBuilder sb = new StringBuilder(num * 2);\n        for (int i = 0; i < num; i++) {\n            if (i != 0) {\n                sb.append(',');\n            }\n            sb.append('?');\n        }\n        return sb.toString();\n    }\n\n    @TargetApi(11)\n    protected Set<String> getKeySet(ContentValues values) {\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {\n            return values.keySet();\n        }\n\n        Set<String> keySet = new HashSet<>();\n        for (Map.Entry<String, Object> item : values.valueSet()) {\n            String key = item.getKey();\n            keySet.add(key);\n        }\n        return keySet;\n\n    }\n\n    protected void validateFields(String[] validFields, ContentValues values)\n        throws IllegalArgumentException {\n        for (final String key : getKeySet(values)) {\n            boolean isValid = false;\n            for (final String validKey : validFields) {\n                if (validKey.equals(key)) {\n                    isValid = true;\n                    break;\n                }\n            }\n\n            if (!isValid) {\n                throw new IllegalArgumentException(\n                    \"Cannot save field '\" + key + \"' to provider \" + getProviderName());\n            }\n        }\n    }\n}\n\n```\n\n### Response:\n```java\npackage org.fdroid.fdroid.data;\n\nimport android.annotation.TargetApi;\nimport android.content.ContentProvider;\nimport android.content.ContentProviderOperation;\nimport android.content.ContentProviderResult;\nimport android.content.ContentValues;\nimport android.content.Context;\nimport android.content.OperationApplicationException;\nimport android.content.UriMatcher;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.net.Uri;\nimport android.os.Build;\nimport android.support.annotation.NonNull;\n\nimport org.fdroid.fdroid.Utils;\n\nimport java.util.ArrayList;\nimport java.util.HashSet;\nimport java.util.Map;\nimport java.util.Set;\n\npublic abstract class FDroidProvider extends ContentProvider {\n\n    private static final String TAG = \"FDroidProvider\";\n\n    public static final String AUTHORITY = \"org.fdroid.fdroid.data\";\n\n    protected static final int CODE_LIST   = 1;\n    protected static final int CODE_SINGLE = 2;\n\n    private static DBHelper dbHelper;\n\n    private boolean isApplyingBatch;\n\n    protected abstract String getTableName();\n\n    protected abstract String getProviderName();\n\n    \/**\n     * Should always be the same as the provider:name in the AndroidManifest\n     *\/\n    public final String getName() {\n        return AUTHORITY + \".\" + getProviderName();\n    }\n\n    \/**\n     * Tells us if we are in the middle of a batch of operations. Allows us to\n     * decide not to notify the content resolver of changes,\n     * every single time we do something during many operations.\n     * Based on http:\/\/stackoverflow.com\/a\/15886915.\n     *\/\n    protected final boolean isApplyingBatch() {\n        return this.isApplyingBatch;\n    }\n\n    @NonNull\n    @Override\n    public ContentProviderResult[] applyBatch(@NonNull ArrayList<ContentProviderOperation> operations)\n        throws OperationApplicationException {\n        ContentProviderResult[] result = null;\n        isApplyingBatch = true;\n        final SQLiteDatabase db = db();\n        db.beginTransaction();\n        try {\n            result = super.applyBatch(operations);\n            db.setTransactionSuccessful();\n        } finally {\n            db.endTransaction();\n            isApplyingBatch = false;\n        }\n        return result;\n    }\n\n    private static synchronized DBHelper getOrCreateDb(Context context) {\n        if (dbHelper == null) {\n            Utils.debugLog(TAG, \"First time accessing database, creating new helper\");\n            dbHelper = new DBHelper(context);\n        }\n        return dbHelper;\n    }\n\n    @Override\n    public boolean onCreate() {\n        return true;\n    }\n\n    protected final synchronized SQLiteDatabase db() {\n        return getOrCreateDb(getContext()).getReadableDatabase();\n    }\n\n    @Override\n    public String getType(@NonNull Uri uri) {\n        String type;\n        switch (getMatcher().match(uri)) {\n            case CODE_LIST:\n                type = \"dir\";\n                break;\n            case CODE_SINGLE:\n            default:\n                type = \"item\";\n                break;\n        }\n        return \"vnd.android.cursor.\" + type + \"\/vnd.\" + AUTHORITY + \".\" + getProviderName();\n    }\n\n    protected abstract UriMatcher getMatcher();\n\n    protected static String generateQuestionMarksForInClause(int num) {\n        StringBuilder sb = new StringBuilder(num * 2);\n        for (int i = 0; i < num; i++) {\n            if (i != 0) {\n                sb.append(',');\n            }\n            sb.append('?');\n        }\n        return sb.toString();\n    }\n\n    @TargetApi(11)\n    protected Set<String> getKeySet(ContentValues values) {\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {\n            return values.keySet();\n        }\n\n        Set<String> keySet = new HashSet<>();\n        for (Map.Entry<String, Object> item : values.valueSet()) {\n            String key = item.getKey();\n            keySet.add(key);\n        }\n        return keySet;\n\n    }\n\n    protected void validateFields(String[] validFields, ContentValues values)\n        throws IllegalArgumentException {\n        for (final String key : getKeySet(values)) {\n            boolean isValid = false;\n            for (final String validKey : validFields) {\n                if (validKey.equals(key)) {\n                    isValid = true;\n                    break;\n                }\n            }\n\n            if (!isValid) {\n                throw new IllegalArgumentException(\n                    \"Cannot save field '\" + key + \"' to provider \" + getProviderName());\n            }\n        }\n    }\n}\n```"
	]
}